<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accounting System - Login</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="login-container" id="login-container">
            <h1>Accounting System</h1>
            <div class="form-container">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter password">
                </div>
                <button id="login-btn" class="btn btn-primary">Login</button>
                <p id="login-error" class="error-message hidden">Invalid username or password</p>
            </div>
        </div>

        <div class="accounting-container hidden" id="accounting-container">
            <div class="header">
                <h1>Accounting System</h1>
                <div class="header-buttons">
                    <button id="list-btn" class="btn btn-primary btn-icon" title="View Entries"><i class="icon">ðŸ“‹</i></button>
                    <button id="logout-btn" class="btn btn-secondary">Logout</button>
                </div>
            </div>

            <div class="form-container">
                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input type="number" id="amount" class="form-control" step="0.01" min="0" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Transaction Type</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="crdr" value="cr" checked> Credit
                        </label>
                        <label>
                            <input type="radio" name="crdr" value="dr"> Debit
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="category">Category</label>
                    <input type="text" id="category" class="form-control" placeholder="Type to search categories">
                    <div class="autocomplete-container" id="category-autocomplete-container">
                        <!-- Category autocomplete suggestions will be populated here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <input type="text" id="description" class="form-control" placeholder="Enter description">
                    <div class="autocomplete-container" id="autocomplete-container">
                        <!-- Autocomplete suggestions will be populated here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Evidences</label>
                    <p class="helper-text">Upload images, PDFs, Excel files, text files, or CSV files. For Google Sheets or Docs, please export/download them first as Excel (.xlsx) or CSV format.</p>
                    <div class="evidence-container">
                        <div id="selected-files-container" class="selected-files-container">
                            <!-- Selected files will be shown here -->
                        </div>
                        <div class="evidence-buttons">
                            <label for="camera-input" class="btn btn-outline">Capture from Camera</label>
                            <input type="file" id="camera-input" accept="image/*" capture="environment" hidden>
                            
                            <label for="file-input" class="btn btn-outline">Select Files</label>
                            <input type="file" id="file-input" accept="image/*, application/pdf, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/plain, text/csv, application/vnd.oasis.opendocument.spreadsheet, application/vnd.oasis.opendocument.text, application/vnd.google-apps.spreadsheet, application/vnd.google-apps.document" multiple hidden>
                        </div>
                    </div>
                </div>
                
                <button id="submit-btn" class="btn btn-primary">Submit</button>
            </div>
        </div>

        <!-- Listing Screen Container -->
        <div class="listing-container hidden" id="listing-container">
            <div class="header">
                <h1>Transaction Entries</h1>
                <div class="header-buttons">
                    <button id="add-entry-btn" class="btn btn-primary btn-icon" title="Add New Entry"><i class="icon">âž•</i></button>
                    <button id="list-logout-btn" class="btn btn-secondary">Logout</button>
                </div>
            </div>

            <div class="filter-container">
                <div class="filter-form">
                    <div class="filter-row">
                        <div class="form-group">
                            <label for="query-string">Search</label>
                            <input type="text" id="query-string" class="form-control" placeholder="Search in description or category">
                        </div>
                        <div class="form-group">
                            <label for="start-date">Start Date</label>
                            <div class="date-input-wrapper">
                                <input type="date" id="start-date" class="form-control">
                                <button type="button" id="clear-start-date" class="btn-clear-date">Ã—</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="end-date">End Date</label>
                            <div class="date-input-wrapper">
                                <input type="date" id="end-date" class="form-control">
                                <button type="button" id="clear-end-date" class="btn-clear-date">Ã—</button>
                            </div>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button id="filter-btn" class="btn btn-primary">Filter</button>
                        <button id="reset-filter-btn" class="btn btn-outline">Reset</button>
                        <button id="export-btn" class="btn btn-outline">Export CSV</button>
                    </div>
                </div>
            </div>

            <div class="entries-container" id="entries-container">
                <!-- Entries will be populated here -->
                <div class="loading-message" id="loading-message">Loading transactions...</div>
                <div class="no-entries-message hidden" id="no-entries-message">No transactions found.</div>
            </div>

            <div class="pagination-container">
                <button id="load-more-btn" class="btn btn-outline hidden">Load More</button>
            </div>
        </div>
    </div>

    <!-- CryptoJS library from official CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- bcryptjs library from official CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
    
    <!-- CryptoJS verification script -->
    <script>
      // Verify CryptoJS is loaded correctly
      document.addEventListener('DOMContentLoaded', function() {
        console.log('CryptoJS loaded check:', typeof CryptoJS);
        console.log('HmacSHA512 method check:', typeof CryptoJS?.HmacSHA512);
        
        // Test HMAC generation
        try {
          const testMessage = '<<test-message>>';
          const testSecret = '<<test-secret>>';
          const testHash = CryptoJS.HmacSHA512(testMessage, testSecret).toString(CryptoJS.enc.Hex);
          console.log('HMAC SHA-512 test successful!');
          console.log('Message:', testMessage);
          console.log('Secret:', testSecret);
          console.log('Generated hash:', testHash);
          
          // Test with components used in the securityService
          const timestamp = new Date().toISOString();
          const domain = window.location.hostname;
          const xmessage = `${domain}:${timestamp}`;
          const password = '<<password>>';
          
          console.log('Testing with components similar to securityService:');
          console.log('x-message:', xmessage);
          console.log('password:', password);
          
          const signature = CryptoJS.HmacSHA512(xmessage, password).toString(CryptoJS.enc.Hex);
          console.log('Generated x-signature:', signature.substring(0, 20) + '...');
          console.log('Full signature length:', signature.length);
          console.log('Test HMAC generation successful:', testHash.substring(0, 20) + '...');
        } catch (e) {
          console.error('CryptoJS test failed:', e);
        }
      });
    </script>
    
    <!-- Import our modularized application JavaScript -->
    <script src="js/app.js" type="module"></script>
</body>
</html>
